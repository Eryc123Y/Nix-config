#!/bin/bash

# SketchyBar Configuration
source "$CONFIG_DIR/colors.sh" # Loads all defined colors
source "$CONFIG_DIR/icons.sh"  # Loads all defined icons

ITEM_DIR="$CONFIG_DIR/items"
PLUGIN_DIR="$CONFIG_DIR/plugins"

# Setting up and starting the helper process (commented out - no helper directory)
# HELPER=git.felix.helper
# killall helper 2>/dev/null
# (
#   cd $CONFIG_DIR/helper && make
# ) &>/dev/null
# $CONFIG_DIR/helper/helper $HELPER >/dev/null 2>&1 &

# Unload the macOS on screen indicator overlay for volume and brightness
launchctl unload -w /System/Library/LaunchAgents/com.apple.OSDUIHelper.plist 2>/dev/null

# Setting up the general bar appearance and default values
sketchybar --bar \
    height=45 \
    color=$BAR_COLOR \
    border_width=2 \
    border_color=$BAR_BORDER_COLOR \
    shadow=off \
    position=top \
    sticky=off \
    padding_left=10 \
    padding_right=10 \
    corner_radius=9 \
    y_offset=10 \
    margin=10 \
    blur_radius=30 \
    notch_width=200

# Setting up default values
sketchybar --default \
    updates=when_shown \
    drawing=on \
    icon.font="Hack Nerd Font:Bold:17.0" \
    icon.color=$ICON_COLOR \
    icon.padding_left=4 \
    icon.padding_right=4 \
    label.font="Hack Nerd Font:Bold:14.0" \
    label.color=$LABEL_COLOR \
    label.padding_left=4 \
    label.padding_right=4 \
    background.color=$ITEM_BG_COLOR \
    background.corner_radius=5 \
    background.height=24 \
    popup.background.border_width=2 \
    popup.background.corner_radius=9 \
    popup.background.border_color=$POPUP_BORDER_COLOR \
    popup.background.color=$POPUP_BACKGROUND_COLOR \
    popup.blur_radius=20 \
    popup.background.shadow.drawing=on

# Left side items
source "$ITEM_DIR/apple.sh"
source "$ITEM_DIR/spaces.sh"
source "$ITEM_DIR/front_app.sh"

# Right side items
source "$ITEM_DIR/calendar.sh"
source "$ITEM_DIR/wifi.sh"
source "$ITEM_DIR/battery.sh"
source "$ITEM_DIR/volume.sh"

sketchybar --hotload on

# Forcing all item scripts to run the first time (never do this outside of sketchybarrc)
sketchybar --update

echo "sketchybar configuation loaded.."
